# 跨平台（Windows/Linux/macOS）C++界面库基础组件设计
开发跨平台（Windows/macOS/Linux）的C++界面库，核心是先覆盖**跨平台通用的基础组件**（满足90%的常规开发需求），同时兼顾各平台原生交互逻辑与视觉一致性，组件设计需遵循“抽象层统一接口+平台层适配实现”的架构。以下是必须包含的基础组件分类及核心细节：

## 一、核心基础层组件（支撑所有界面的底层能力）
这类组件不直接呈现UI，但决定界面库的跨平台稳定性和基础能力，是所有可视化组件的依赖。

| 组件/模块 | 核心功能 | 跨平台适配要点 |
|-----------|----------|----------------|
| 窗口核心（Window） | 1. 基础窗口创建/销毁/隐藏/置顶/全屏<br>2. 窗口大小/位置调整、多显示器适配<br>3. 窗口事件（关闭/最小化/最大化/移动/重绘）<br>4. 模态/非模态窗口支持 | - Windows：适配HWND、Win32消息循环；<br>- macOS：适配NSWindow、Cocoa事件响应；<br>- Linux：适配X11/Wayland、GTK/KDE窗口管理器；<br>- 统一窗口样式（圆角/阴影）的跨平台渲染逻辑 |
| 应用程序框架（Application） | 1. 跨平台主循环（消息泵/事件循环）<br>2. 应用生命周期管理（启动/退出/暂停）<br>3. 资源管理（全局字体/图标/配置）<br>4. 命令行参数解析、日志输出 | - 屏蔽各平台主循环差异（Windows `GetMessage`/macOS `NSRunLoop`/Linux `poll`）；<br>- 统一应用级异常捕获、退出码定义 |
| 事件系统（Event System） | 1. 统一的事件模型（鼠标/键盘/触摸/窗口事件）<br>2. 事件分发/冒泡/捕获机制<br>3. 自定义事件支持（跨线程事件投递）<br>4. 事件过滤器（拦截/修改事件） | - 统一事件类型（如鼠标左键按下：`EVT_MOUSE_LEFT_DOWN`），屏蔽平台原生事件差异；<br>- 支持触摸事件（macOS/iOS触控板、Windows触摸屏、Linux触控设备）；<br>- 解决Linux下不同桌面环境（GNOME/KDE）的事件兼容问题 |
| 渲染上下文（Render Context） | 1. 跨平台绘图上下文（封装GDI/Quartz/OpenGL/Vulkan）<br>2. 双缓冲渲染（避免闪屏）<br>3. 高DPI适配（Retina/4K屏幕、缩放比例同步）<br>4. 图形基元绘制（点/线/矩形/路径/文本） | - 抽象渲染接口，底层可切换（如2D用Skia，3D用OpenGL）；<br>- 统一高DPI逻辑（Windows DPI感知、macOS Retina缩放、Linux Xft/DPI设置）；<br>- 支持抗锯齿、透明度（Alpha通道）渲染 |

## 二、基础容器组件（界面布局的核心骨架）
容器组件负责承载和排布其他组件，需支持跨平台一致的布局规则（如流式、弹性、绝对布局）。

| 组件 | 核心功能 | 跨平台适配要点 |
|------|----------|----------------|
| 基础窗口（Window）/ 对话框（Dialog） | 见“核心基础层”，补充：<br>1. 对话框分“模态对话框”（阻塞父窗口）和“非模态对话框”；<br>2. 支持系统原生对话框样式（如Windows的对话框边框、macOS的sheet弹窗） | - 避免自定义窗口样式与平台原生冲突（如macOS窗口无最大化按钮、Linux窗口装饰依赖桌面环境）；<br>- 对话框按钮布局适配平台习惯（Windows“确定/取消”在右，macOS“取消/确定”在右） |
| 面板（Panel） | 1. 无装饰的基础容器，用于分组组件；<br>2. 支持背景色/背景图、边框样式；<br>3. 嵌套布局（面板内可放其他容器/组件） | - 统一边框渲染逻辑（Windows的GDI边框、macOS的Quartz边框、Linux的Cairo边框）；<br>- 背景图缩放/平铺规则跨平台一致 |
| 布局容器（Layout Container） | 核心是封装常用布局算法，避免手动计算组件位置：<br>1. 水平布局（HBox）：组件横向排列；<br>2. 垂直布局（VBox）：组件纵向排列；<br>3. 网格布局（Grid）：行列对齐（如表格、表单）；<br>4. 弹性布局（Flex）：自适应空间分配（优先级/权重）；<br>5. 绝对布局（Absolute）：手动指定坐标/大小 | - 屏蔽各平台布局引擎差异（如macOS AutoLayout、Windows LayoutManager、Linux GTK布局）；<br>- 支持布局间距（Margin/Padding）、对齐方式（左/中/右、上/中/下）的统一配置；<br>- 响应式适配（窗口缩放时组件自动调整） |
| 滚动容器（ScrollView） | 1. 单轴/双轴滚动（横向/纵向）；<br>2. 滚动条样式（原生/自定义）；<br>3. 滚动事件、滚动位置控制；<br>4. 大内容懒加载支持 | - 适配各平台滚动条交互（Windows点击滚动条空白处跳页、macOS滚动条自动隐藏、Linux滚动条样式随桌面环境）；<br>- 支持触摸滚动（惯性滚动）的跨平台统一实现 |
| 分割面板（Splitter） | 1. 水平/垂直分割容器（如左右分栏、上下分栏）；<br>2. 拖拽调整分割线位置；<br>3. 分割线样式、最小/最大尺寸限制 | - 拖拽手感适配平台（Windows拖拽阻尼、macOS顺滑拖拽、Linux轻量拖拽）；<br>- 分割线hover状态的视觉反馈统一 |

## 三、基础交互组件（用户操作的核心载体）
这类组件是用户与程序交互的核心，需保证跨平台交互逻辑一致，视觉可适配原生风格。

| 组件 | 核心功能 | 跨平台适配要点 |
|------|----------|----------------|
| 按钮（Button） | 1. 基础按钮（文本/图标/图文）；<br>2. 状态：正常/hover/按下/禁用/聚焦；<br>3. 特殊按钮：复选按钮（Checkbox）、单选按钮（RadioButton）、切换按钮（ToggleButton）；<br>4. 按钮组（RadioGroup）：管理单选按钮互斥 | - 视觉样式可切换“原生风格”（如Windows Fluent按钮、macOS液态玻璃按钮、Linux GTK按钮）；<br>- 键盘交互一致（Enter/Space触发按钮）；<br>- 复选/单选按钮的勾选样式适配平台习惯 |
| 文本输入（Input/TextField/TextArea） | 1. 单行输入（TextField）、多行输入（TextArea）；<br>2. 输入限制（长度/正则/数字/密码）；<br>3. 占位符（Placeholder）、自动换行、滚动；<br>4. 输入法适配（中文/日文等）、光标控制；<br>5. 文本选择、复制/粘贴/剪切 | - 屏蔽各平台输入法接口差异（Windows IME、macOS Input Method、Linux fcitx）；<br>- 光标样式、选中文本高亮色适配平台原生；<br>- 解决Linux下不同桌面环境的文本渲染差异 |
| 下拉选择（ComboBox/DropDown） | 1. 下拉列表展示选项、单选选择；<br>2. 可编辑下拉框（输入+选择）；<br>3. 选项过滤、滚动；<br>4. 展开/收起动画、禁用状态 | - 下拉列表的弹出位置适配（Windows在按钮下方、macOS贴合按钮边缘、Linux随桌面环境）；<br>- 避免下拉列表被窗口边界截断的跨平台处理 |
| 列表（List/ListView） | 1. 单列/多列列表、条目渲染；<br>2. 条目选择（单选/多选）、hover/选中状态；<br>3. 滚动、懒加载、条目高度自适应；<br>4. 列表头（ListHeader）、列宽调整 | - 条目点击/双击事件的跨平台一致性；<br>- 大列表性能优化（虚拟列表，仅渲染可视区域）；<br>- Linux下不同桌面环境的列表滚动性能适配 |
| 菜单（Menu/MenuBar/ContextMenu） | 1. 顶部菜单栏（MenuBar）、上下文菜单（右键菜单）；<br>2. 菜单项（文本/图标/快捷键/分隔线）；<br>3. 子菜单、禁用/勾选状态；<br>4. 快捷键触发（如Ctrl+C/Command+C） | - 菜单栏位置适配（Windows在窗口内、macOS在系统顶部、Linux随桌面环境）；<br>- 快捷键映射统一（如Ctrl/Command、Alt/Option的跨平台转换）；<br>- 上下文菜单弹出位置适配（避免超出屏幕） |

## 四、基础展示组件（信息呈现的核心）
这类组件专注信息展示，无需复杂交互，但需保证跨平台视觉一致。

| 组件 | 核心功能 | 跨平台适配要点 |
|------|----------|----------------|
| 文本（Label） | 1. 单行/多行文本、富文本（简单样式：颜色/字体/大小）；<br>2. 文本对齐（左/中/右、上/中/下）；<br>3. 自动换行、省略号（超出宽度显示...）；<br>4. 支持图标+文本组合 | - 字体渲染统一（封装FreeType/系统字体接口，避免各平台字体差异）；<br>- 富文本仅保留跨平台通用样式（避免依赖平台专属的文本格式） |
| 图片（Image/ImageView） | 1. 加载常见格式（PNG/JPG/BMP/SVG）；<br>2. 缩放模式（拉伸/等比/居中/裁剪）；<br>3. 透明度、圆角、边框；<br>4. 动图（GIF）基础播放 | - 图片解码跨平台统一（封装libpng/libjpeg等开源库，避免系统解码差异）；<br>SVG矢量图渲染一致（避免macOS/Linux下缩放失真） |
| 进度条（ProgressBar） | 1. 线性进度条（水平）、环形进度条（可选）；<br>2. 进度值（0-100）、进度文本（如50%）；<br>3. 进度颜色、背景色、禁用状态 | - 线性进度条样式适配平台（Windows的分段进度、macOS的平滑进度、Linux的简约进度）；<br>- 进度更新的动画流畅度跨平台一致 |
| 滑块（Slider） | 1. 水平/垂直滑块、数值范围（最小值/最大值）；<br>2. 步长、当前值、拖拽调整；<br>3. 刻度标记、tooltip提示值 | - 滑块拖拽的手感（阻尼/顺滑）适配平台习惯；<br>- 刻度样式、滑块按钮样式可切换原生风格 |
| 分隔线（Separator） | 1. 水平/垂直分隔线；<br>2. 颜色、粗细、间距 | - 分隔线的视觉风格适配平台（Windows细灰线、macOS浅灰线、Linux随主题）；<br>- 嵌套在布局中时的间距计算统一 |

## 五、辅助工具类组件（提升开发效率的跨平台工具）
这类组件不是可视化UI，但能大幅降低跨平台开发成本，是界面库的“基础设施”。

| 组件/工具 | 核心功能 |
|-----------|----------|
| 资源管理器（ResourceManager） | 1. 跨平台加载资源（字体/图标/图片/配置文件）；<br>2. 资源路径统一（屏蔽Windows `\`、macOS/Linux `/` 差异）；<br>3. 资源缓存、释放管理 |
| 样式系统（Style/Theme） | 1. 统一的样式接口（颜色/字体/边距/圆角）；<br>2. 原生主题适配（Windows浅色/深色、macOS系统主题、Linux GTK主题）；<br>3. 自定义主题、样式继承/覆盖 |
| 定时器（Timer） | 1. 单次/循环定时器；<br>2. 跨平台时间精度（毫秒级）；<br>3. 定时器回调（主线程触发，避免线程安全问题） |
| 剪贴板（Clipboard） | 1. 文本/图片复制/粘贴；<br>2. 跨平台剪贴板接口统一；<br>3. 剪贴板数据格式转换 |
| 日志工具（Logger） | 1. 分级日志（Debug/Info/Warn/Error）；<br>2. 跨平台日志输出（控制台/文件）；<br>3. 日志格式统一 |

## 六、核心设计原则（保障跨平台可用性）
1. **接口抽象化**：所有组件提供统一的C++抽象接口（如 `Window` 类），底层通过平台适配层（如 `Win32Window`/`CocoaWindow`/`X11Window`）实现，上层业务无需关注平台细节；
2. **最小差异化**：优先实现各平台“通用交互逻辑”，平台特有功能（如macOS的TouchBar、Windows的任务栏进度）作为扩展组件，不纳入基础库；
3. **性能优先**：基础组件需做跨平台性能优化（如虚拟列表、双缓冲、资源懒加载），避免Linux低配置设备卡顿；
4. **原生兼容**：支持“原生样式”和“自定义样式”切换，满足用户对“平台原生视觉”的需求（如macOS按钮的液态玻璃效果、Windows的Fluent圆角）。

## 总结
基础组件覆盖“底层核心+容器+交互+展示+辅助工具”5大类即可满足90%的跨平台C++应用开发需求，后续可基于此扩展高级组件（如表格Table、树控件TreeView、标签页TabView）。核心是通过“抽象层统一接口”屏蔽平台差异，同时保证组件的交互逻辑、视觉风格在各平台既统一又适配原生习惯。